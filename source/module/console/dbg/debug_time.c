// Urheberrecht 2018-2020 ESoPe GmbH, Alle Rechte vorbehalten
/**
 * @file debug_time.c
 * @copyright Urheberrecht 2018-2020 ESoPe GmbH, Alle Rechte vorbehalten
 **/

#include "module_public.h"
#if MODULE_ENABLE_DEBUG_CONSOLE && MODULE_ENABLE_RTC
#include "module/convert/string.h"
#include "module/rtc/rtc.h"
#include "module/console/console.h"

//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Internal definitions
//-----------------------------------------------------------------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Internal structures and enums
//-----------------------------------------------------------------------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Internal variables
//-----------------------------------------------------------------------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Prototypes
//-----------------------------------------------------------------------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// External Functions
//-----------------------------------------------------------------------------------------------------------------------------------------------------------
FUNCTION_RETURN debug_time_execute(console_data_t* data, char* line)
{
	rtc_time_t t;
	char* ptr = NULL;
	if(strstr(line, "getf") == line)
	{
		rtc_get_time(&t);
		return console_set_response_dynamic(data, FUNCTION_RETURN_OK, 50, "get \\\"%D %T %ums\\\"", &t, &t, t.tm_msec);
	}
	else if(strstr(line, "get") == line)
	{
		rtc_get_time(&t);
		return console_set_response_dynamic(data, FUNCTION_RETURN_OK, 50, "get \\\"%D %T\\\"", &t, &t);
	}
	else if(strstr(line, "set ") == line)
	{
		line += 4;
		ptr = string_parse_datetime(line, "D.M.Y h:m:s", &t);

		if(ptr != NULL)
		{
			rtc_set_time(&t);
			return console_set_response_dynamic(data, FUNCTION_RETURN_OK, 50, "set \\\"%D %T\\\"", &t, &t);
		}
		else
		{
			return console_set_response_static(data, FUNCTION_RETURN_PARAM_ERROR, "Time format invalid");
		}
	}
	else
		return FUNCTION_RETURN_NOT_FOUND;

	return FUNCTION_RETURN_OK;
}

//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Internal Functions
//-----------------------------------------------------------------------------------------------------------------------------------------------------------

#endif
