/***
 * @file mcu_rtc.c
 * @copyright Urheberrecht 2018-2024 ESoPe GmbH, Alle Rechte vorbehalten. Released under an Apache 2.0 license.
 **/

#include "../mcu.h"

#if MCU_TYPE == PC_EMU && MCU_PERIPHERY_ENABLE_RTC

#include <time.h>
#include <sys/time.h>
#include "module/comm/dbg.h"

//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Internal definitions
//-----------------------------------------------------------------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Internal structures and enums
//-----------------------------------------------------------------------------------------------------------------------------------------------------------


//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Internal variables
//-----------------------------------------------------------------------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Prototypes
//-----------------------------------------------------------------------------------------------------------------------------------------------------------

//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// External Functions
//-----------------------------------------------------------------------------------------------------------------------------------------------------------
void mcu_rtc_init(bool use_ext_sub)
{

}

void mcu_rtc_set_time(rtc_time_t *t)
{
	DBG_INFO("Time would be set to %D %T %ums\n", t, t, t->tm_msec);
}

void mcu_rtc_get_time(rtc_time_t *t)
{
	time_t rawtime;
	struct tm* timeinfo;
	struct timeval tv;

	if(t == NULL)
		return;

	gettimeofday(&tv, NULL);
	rawtime = tv.tv_sec;
	timeinfo = localtime(&rawtime);

	t->tm_year = timeinfo->tm_year;
	t->tm_mon = timeinfo->tm_mon;
	t->tm_mday = timeinfo->tm_mday;
	t->tm_hour = timeinfo->tm_hour;
	t->tm_min = timeinfo->tm_min;
	t->tm_sec = timeinfo->tm_sec;
	t->tm_msec = tv.tv_usec / 1000;
	t->tm_timezone = 1; // Just assume germany here, we only use it for testing our software
}


//-----------------------------------------------------------------------------------------------------------------------------------------------------------
// Internal Functions
//-----------------------------------------------------------------------------------------------------------------------------------------------------------


#endif
